"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("react/jsx-runtime"),r=require("react"),G=require("react-dom"),_=r.createContext(null),J=({children:e})=>{const[t,c]=r.useState({setEditor:s=>{c(n=>({...n,editor:s}))}});return o.jsx(_.Provider,{value:t,children:e})},m=()=>{const e=r.useContext(_);if(!e)throw new Error("useEditorInstance must be used within EditorInstanceProvider");return e},K=()=>{const{editor:e}=m();if(!e)throw new Error("useEditor used before the load of the editor instance. You can wrap your component in `<WithEditor>` or make use of `useEditorMaybe` hook and ensure the `editor` exists.");return e},D=()=>m().editor,W=r.createContext(null),Q=({children:e})=>{const[t,c]=r.useState(()=>({setRefCanvas(s){c(n=>({...n,refCanvas:s}))},setCustomModal(s){c(n=>({...n,customModal:s}))},setCustomAssets(s){c(n=>({...n,customAssets:s}))},setCustomBlocks(s){c(n=>({...n,customBlocks:s}))},setCustomRte(s){c(n=>({...n,customRte:s}))},setCustomStyles(s){c(n=>({...n,customStyles:s}))},setCustomLayers(s){c(n=>({...n,customLayers:s}))},setCustomSelectors(s){c(n=>({...n,customSelectors:s}))},setCustomTraits(s){c(n=>({...n,customTraits:s}))},setReady(s){c(n=>({...n,ready:s}))}}));return o.jsx(W.Provider,{value:t,children:e})},S=()=>{const e=r.useContext(W);if(!e)throw new Error("useEditorOptions must be used within EditorOptionsProvider");return e};function U(...e){return(Array.isArray(e[0])?e[0]:[...e]).filter(Boolean).join(" ")}function x(e){return typeof e=="function"}function p(){}const q=e=>typeof e=="string",V=async e=>{const t=document.createElement("link");t.href=e,t.rel="stylesheet",document.head.appendChild(t)},N=e=>{const t=q(e)?{id:e,src:e}:e;return new Promise((c,s)=>{const n=document.createElement("script");if(document.querySelector(`script[src="${t.src}"]`))return c(t.id);n.src=t.src,n.onload=()=>c(t.id),n.onerror=()=>s(t.id),document.head.appendChild(n)})},X=e=>{const t=e.map(c=>N(c));return Promise.allSettled(t)},A=e=>function(){const c=r.useRef(null);return r.useEffect(()=>{const{current:s}=c;s&&(q(e)?s.innerHTML=e:s.appendChild(e))},[c.current]),o.jsx("div",{ref:c})},I=new WeakMap;function j(e){if(!e)return()=>o.jsx(o.Fragment,{});const t=I.get(e);if(t)return t;const c=function({children:n}){return G.createPortal(r.createElement("div",null,n),e)};return I.set(e,c),c}const Z=r.memo(function({children:e}){const{editor:t}=m(),c=S(),[s,n]=r.useState(!1),[i,a]=r.useState({assets:[],types:[],close:()=>{},select:()=>{},Container:()=>o.jsx(o.Fragment,{})});return r.useEffect(()=>{if(!t)return;const u=t.Assets.events.custom,d=({open:f,assets:v,types:C,select:E,close:l,container:y})=>{f&&a({assets:v,types:C,select:E,close:l,Container:j(y)}),n(f)};return t.on(u,d),()=>{t.off(u,d)}},[t]),r.useEffect(()=>c.setCustomAssets(!0),[]),t?x(e)?e({open:s,...i}):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})}),tt=r.memo(function({children:e}){const{editor:t}=m(),c=S(),[s,n]=r.useState(()=>({blocks:[],dragStart:p,dragStop:p,mapCategoryBlocks:new Map,Container:()=>o.jsx(o.Fragment,{})}));return r.useEffect(()=>{if(!t)return;const i=t.Blocks.events.custom,a=({blocks:u,container:d,dragStart:f,dragStop:v})=>{const C=u.reduce((E,l)=>{const y=l.getCategoryLabel(),P=E.get(y);return P?P.push(l):E.set(y,[l]),E},new Map);n({blocks:u,dragStart:f,dragStop:v,mapCategoryBlocks:C,Container:j(d)})};return t.on(i,a),t.Blocks.__trgCustom(),()=>{t.off(i,a)}},[t]),r.useEffect(()=>c.setCustomBlocks(!0),[]),t?x(e)?e(s):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})});function et({children:e,...t}){const c=S(),s=r.useRef(null);return r.useEffect(()=>{s.current&&c.setRefCanvas(s.current)},[s.current]),o.jsx("div",{...t,ref:s,children:e})}const st=r.memo(function({children:e}){const{editor:t}=m(),[c,s]=r.useState(()=>({devices:[],selected:"",select:p}));return r.useEffect(()=>{if(!t)return;const{Devices:n}=t,i=n.events.all,a=()=>{var u;s({devices:n.getDevices(),selected:(u=n.getSelected())==null?void 0:u.id,select:d=>n.select(d)})};return t.on(i,a),a(),()=>{t.off(i,a)}},[t]),t?x(e)?e(c):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})}),ot=e=>!!(e&&!Array.isArray(e)&&typeof e=="object");async function nt(e){const t=e.map(({id:a,src:u})=>({id:a,src:u})),c=e.reduce((a,u)=>(a[u.id]=u,a),{}),s=[],n=[];return(await X(t)).forEach(a=>{a.status==="fulfilled"?s.push(c[a.value]):n.push(c[a.reason])}),{loaded:s,failed:n}}const rt=async e=>{const t=[...e],c={};if(t.length){const s={},n=[];if(t.forEach((i,a)=>{ot(i)&&(s[i.id]={index:a},n.push(i))}),n.length){const{loaded:i}=await nt(n);i.forEach(({id:a,options:u})=>{s[a].loaded=!0,c[a]=u||{}})}Object.keys(s).forEach(i=>{const a=s[i];a.loaded?t[a.index]=i:t[a.index]=!1})}return{plugins:t.filter(Boolean),pluginOptions:c}},ct=r.memo(function({children:e,className:t,style:c,options:s={},plugins:n=[],grapesjs:i,grapesjsCss:a,onEditor:u=p,onReady:d,onUpdate:f,waitReady:v,...C}){const{setEditor:E}=m(),l=S(),[y,P]=r.useState(!1),F=r.useRef(null);r.useEffect(()=>{if(!l.ready||!F.current)return;const $=F.current,w=l.refCanvas;let g,T={},b=[];const B=h=>{const z={height:"100%",...s,plugins:[...b,...s.plugins||[]],pluginsOpts:{...s.pluginsOpts,...T},modal:{custom:!!l.customModal,...s.modal},assetManager:{custom:!!l.customAssets,...s.assetManager},styleManager:{custom:!!l.customStyles,...s.styleManager},blockManager:{custom:!!l.customBlocks,...s.blockManager},richTextEditor:{custom:!!l.customRte,...s.richTextEditor},layerManager:{custom:!!l.customLayers,...s.layerManager},traitManager:{custom:!!l.customTraits,...s.traitManager},selectorManager:{custom:!!l.customSelectors,...s.selectorManager},container:w||$,customUI:!!w,...w?{panels:{defaults:[]}}:{}};g=h.init(z),E(g),u(g),f&&g.on("update",()=>{f(g.getProjectData(),g)}),g.onReady(()=>{P(!0),d==null||d(g)})};return(async()=>{a&&await V(a);const h=await rt(n);b=h.plugins,T=h.pluginOptions,typeof i=="string"?(await N(i),B(window.grapesjs)):B(i)})(),()=>g==null?void 0:g.destroy()},[l.ready]);const O=s.height??"100%",k=s.width??"100%",L=U("gjs-editor-wrapper",t),R=v&&!y,M=r.useMemo(()=>({...c,height:O,width:k}),[O,k,c]),Y=r.useMemo(()=>({...M,...R?{opacity:0,width:0,height:0}:{}}),[M,R]);return o.jsxs(o.Fragment,{children:[v&&!y?o.jsx("div",{className:L,style:M,children:v}):null,o.jsx("div",{...C,ref:F,className:L,style:Y,children:e})]})}),at=r.memo(function(){const e=S();return r.useEffect(()=>e.setReady(!0),[]),o.jsx(o.Fragment,{})}),H=r.memo(function({children:t,...c}){return o.jsx(J,{children:o.jsx(Q,{children:o.jsxs(ct,{...c,children:[t,o.jsx(at,{})]})})})}),it=r.memo(function({children:e}){const{editor:t}=m(),c=S(),[s,n]=r.useState(()=>({root:void 0,Container:()=>o.jsx(o.Fragment,{})}));return r.useEffect(()=>{if(!t)return;const{Layers:i}=t,a=i.events.custom,u=({container:d})=>{n({root:i.getRoot(),Container:j(d)})};return t.on(a,u),i.__trgCustom({}),()=>{t.off(a,u)}},[t]),r.useEffect(()=>c.setCustomLayers(!0),[]),t?x(e)?e(s):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})}),ut=r.memo(function({children:e}){const{editor:t}=m(),c=S(),[s,n]=r.useState(!1),[i,a]=r.useState({title:o.jsx(o.Fragment,{}),content:o.jsx(o.Fragment,{}),attributes:{},close:p});return r.useEffect(()=>{if(!t)return;const u="modal",d=({open:f,title:v,content:C,close:E,attributes:l})=>{f&&a({title:r.createElement(A(v)),content:r.createElement(A(C)),attributes:l,close:E}),n(f)};return t.on(u,d),()=>{t.off(u,d)}},[t]),r.useEffect(()=>c.setCustomModal(!0),[]),t?typeof e=="function"?e({open:s,...i}):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})}),dt=r.memo(function({children:e}){const{editor:t}=m(),[c,s]=r.useState(()=>({pages:[],selected:void 0,select:p,add:p,remove:p}));return r.useEffect(()=>{if(!t)return;const{Pages:n}=t,i=n.events.all,a=()=>{s({pages:n.getAll(),selected:n.getSelected(),select:(...u)=>n.select(...u),add:(...u)=>n.add(...u),remove:(...u)=>n.remove(...u)})};return t.on(i,a),a(),()=>{t.off(i,a)}},[t]),t?x(e)?e(c):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})}),lt=r.memo(function({children:e}){const{editor:t}=m(),c=S(),[s,n]=r.useState(()=>({selectors:[],states:[],selectedState:"",targets:[],addSelector:p,removeSelector:p,setState:p,Container:()=>o.jsx(o.Fragment,{})}));return r.useEffect(()=>{if(!t)return;const{Selectors:i}=t,a=i.events.custom,u=({container:d})=>{n({selectors:i.getSelected(),states:i.getStates(),selectedState:i.getState(),targets:i.getSelectedTargets().map(f=>f.getSelectorsString()),addSelector:(...f)=>i.addSelected(...f),removeSelector:(...f)=>i.removeSelected(...f),setState:(...f)=>i.setState(...f),Container:j(d)})};return t.on(a,u),()=>{t.off(a,u)}},[t]),r.useEffect(()=>c.setCustomSelectors(!0),[]),t?x(e)?e(s):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})}),ft=r.memo(function({children:e}){const{editor:t}=m(),c=S(),[s,n]=r.useState(()=>({sectors:[],Container:()=>o.jsx(o.Fragment,{})}));return r.useEffect(()=>{if(!t)return;const{Styles:i}=t,a=i.events.custom,u=({container:d})=>{n({sectors:i.getSectors({visible:!0}),Container:j(d)})};return t.on(a,u),()=>{t.off(a,u)}},[t]),r.useEffect(()=>c.setCustomStyles(!0),[]),t?x(e)?e(s):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})}),mt=r.memo(function({children:e}){const{editor:t}=m(),c=S(),[s,n]=r.useState(()=>({traits:[],Container:()=>o.jsx(o.Fragment,{})}));return r.useEffect(()=>{if(!t)return;const{Traits:i}=t,a=i.events.custom,u=({container:d})=>{n({traits:i.getCurrent(),Container:j(d)})};return t.on(a,u),i.__trgCustom(),()=>{t.off(a,u)}},[t]),r.useEffect(()=>c.setCustomTraits(!0),[]),t?x(e)?e(s):o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{})}),gt=({children:e})=>D()?o.jsx(o.Fragment,{children:e}):o.jsx(o.Fragment,{});exports.AssetsProvider=Z;exports.BlocksProvider=tt;exports.Canvas=et;exports.DevicesProvider=st;exports.Editor=H;exports.LayersProvider=it;exports.ModalProvider=ut;exports.PagesProvider=dt;exports.SelectorsProvider=lt;exports.StylesProvider=ft;exports.TraitsProvider=mt;exports.WithEditor=gt;exports.default=H;exports.useEditor=K;exports.useEditorMaybe=D;
